import{u as J,a as K,b as v,r as t,c as O,j as f,C as y,d as s,F as P,f as W,e as g,B as R,g as X,s as Y,h as x,q as Z,i as ee}from"./main-60d54c96.js";function F({comment:e,index:l,reply:i,parentId:o}){var N,L,b,w;const{auth:n}=J(),S=K(),u=v(a=>a.recipe.activeRecipeId),d=v(a=>{var r;return(r=a.user.likedComments.filter(m=>m.recipeId===u)[0])==null?void 0:r.comments.includes(e._id)}),[c,j]=t.useState(e._id),[q,ne]=t.useState(),[k,B]=t.useState(d),[T,$]=t.useState(q?-1:1),A=new Date(e.date).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),[H,D]=t.useState("Reply"),[C,E]=t.useState(!1),[I,_]=t.useState(!1),[h,M]=t.useState([]),[p,Q]=t.useState([]),U=O({mutationFn:te,onSuccess:({data:a})=>{Z.setQueryData(["comments",u],r=>r?r.filter(m=>m._id!==c):[])}});t.useEffect(()=>{j(e._id)}),t.useEffect(()=>{B(d)},[d,e._id]),t.useEffect(()=>{i||M(e.replies)},[e.replies]),t.useEffect(()=>{Q(h==null?void 0:h.filter(a=>!a.hidden))},[h]),t.useEffect(()=>{$(k?-1:1)},[k]);function V(){async function a(){var r;try{const m=await x.post(`/comments/${c}/like`,{inc:T,commentId:c,recipeId:u,profileId:((r=n==null?void 0:n.user)==null?void 0:r._id)||"64782f70a4a50f0efa0de498",commentIndex:l})}catch(m){console.log(m)}}a(),S(Y({recipeId:u,commentId:c,type:k?"remove":"add"}))}function z(a){a.preventDefault(),E(!C)}t.useEffect(()=>{D(C?"Cancel":"Reply")},[C]);function G(a){a.preventDefault(),c&&U.mutate({commentId:c,parentId:o})}return f(y,{className:"comment border border-2 mb-2 p-2 "+(e.profileId==((N=n==null?void 0:n.user)==null?void 0:N._id)?"me":""),children:[f(y,{className:"d-flex gap-1",children:[s("span",{className:"text-secondary username",children:e.username})," ",s("span",{children:" • "}),s("span",{children:A})]}),s(y,{children:s("p",{children:e.content})}),f(y,{className:"d-flex gap-2 align-items-center",children:[s(P,{onClick:V,icon:W,className:k?"comment-like-icon liked":"comment-like-icon"}),s("span",{className:"comment-like-counter",children:e.likes+" likes"}),!i&&f(g,{children:[s("span",{children:" • "}),s(R,{variant:"primary px-2",onClick:z,children:H})]}),h!=null&&(p==null?void 0:p.length)>0&&f(g,{children:[s("span",{children:"•"}),s(R,{variant:"primary px-2",onClick:()=>_(!I),children:!i&&I?"Hide Replies":"Show Replies"})]}),(e.profileId==((L=n==null?void 0:n.user)==null?void 0:L._id)||((w=(b=n==null?void 0:n.user)==null?void 0:b.roles)==null?void 0:w.includes(8012)))&&f(g,{children:[s("span",{children:" • "}),s(R,{variant:"danger px-2",onClick:G,children:"Delete"})]})]}),C&&s(X,{replyToCommentId:e._id,setReplying:E,setRepliesVisible:_}),s(y,{className:"replies",children:I&&(p==null?void 0:p.map((a,r)=>s(F,{reply:!0,comment:a,index:l,parentId:c},l+"-reply"+r)))})]})}function te({commentId:e,parentId:l}){return x.post(`/comments/${e}/delete`,{parentId:l})}function ce({setCommentsLength:e}){const l=v(d=>d.recipe.activeRecipeId),i=ee({queryKey:["comments",l],queryFn:se}).data,[o,n]=t.useState([]),[S,u]=t.useState([]);return t.useEffect(()=>{n(i),e(i==null?void 0:i.length)},[i]),t.useEffect(()=>{u(o==null?void 0:o.map((d,c)=>s(F,{reply:!1,comment:d,index:c},c)))},[o]),s("div",{className:"comment-list",children:S})}async function se({queryKey:e}){if(e[1]==="")return[];const l=e[1];return(await x.get(`/recipes/${l}/comments`)).data}export{ce as default};
